name: Release

on:
  release:
    types:
      - published

permissions:
  contents: write

jobs:
  release:
    name: Build and Upload Release Assets
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create integration zip
        run: |
          cd custom_components/spintouch
          zip -r ../../spintouch.zip . -x "*/__pycache__/*"

      - name: Upload release asset
        uses: softprops/action-gh-release@v2
        with:
          files: spintouch.zip

      - name: Generate release notes summary
        run: |
          echo "## Installation" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### HACS (Recommended)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. Add this repository as a custom repository in HACS" >> $GITHUB_STEP_SUMMARY
          echo "2. Search for 'LaMotte WaterLink Spin Touch'" >> $GITHUB_STEP_SUMMARY
          echo "3. Install and restart Home Assistant" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Manual Installation" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. Download \`spintouch.zip\` from this release" >> $GITHUB_STEP_SUMMARY
          echo "2. Extract to your \`custom_components/\` directory" >> $GITHUB_STEP_SUMMARY
          echo "3. Restart Home Assistant" >> $GITHUB_STEP_SUMMARY
