# ESPHome Bluetooth Proxy for LaMotte WaterLink Spin Touch
#
# This configuration creates a simple Bluetooth Proxy that forwards
# BLE traffic to Home Assistant. The SpinTouch integration handles
# all data parsing.
#
# Flash this to an ESP32 device within Bluetooth range of your SpinTouch.

substitutions:
  device_name: spintouch-proxy
  friendly_name: SpinTouch Bluetooth Proxy

esphome:
  name: ${device_name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32dev
  framework:
    type: esp-idf

# Enable logging (set to DEBUG to see BLE advertisements)
logger:
  level: INFO
  logs:
    esp32_ble_tracker: INFO

# Web server for viewing logs at http://<device-ip>/
web_server:
  port: 80

# Enable Home Assistant API
api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot
  ap:
    ssid: "${device_name} Fallback"
    password: !secret fallback_password

# Bluetooth Proxy - forwards all BLE traffic to Home Assistant
bluetooth_proxy:
  active: true

# Enable Bluetooth tracker - filtered to SpinTouch devices only
esp32_ble_tracker:
  scan_parameters:
    active: true
    interval: 1100ms
    window: 1100ms
  on_ble_advertise:
    - then:
        - lambda: |-
            // Only log SpinTouch devices
            if (x.get_name().rfind("SpinTouch", 0) == 0) {
              ESP_LOGI("spintouch", "Found: %s (%s) RSSI: %d",
                x.get_name().c_str(),
                x.address_str().c_str(),
                x.get_rssi());
            }

# Basic device sensors
sensor:
  - platform: wifi_signal
    name: "WiFi Signal"
    update_interval: 60s

  - platform: uptime
    name: "Uptime"
    update_interval: 60s

# Status LED (optional - adjust pin for your board)
# status_led:
#   pin: GPIO2

button:
  - platform: restart
    name: "Restart"
